# 银河证券管理系统 - 部署检查清单

## 概述
本文档为部署银河证券管理系统（证裕交易单元）提供详细的检查清单，确保内容管理模块在生产环境中正常运行。

## 1. 环境准备

### 1.1 服务器环境
- [ ] **操作系统**：Ubuntu 20.04 LTS 或更高版本
- [ ] **Node.js**：v18.0.0 或更高版本
- [ ] **内存**：至少 4GB RAM
- [ ] **存储**：至少 20GB 可用空间
- [ ] **网络**：稳定的互联网连接，开放端口 80/443

### 1.2 域名与SSL
- [ ] **域名**：已注册并解析到服务器IP
- [ ] **SSL证书**：已申请并配置（Let's Encrypt或商业证书）
- [ ] **HTTPS**：强制HTTPS重定向已配置

## 2. Supabase配置

### 2.1 项目创建
- [ ] **Supabase项目**：已创建项目并获取URL和Anon Key
- [ ] **数据库版本**：PostgreSQL 15 或更高版本
- [ ] **区域**：选择合适的地理区域（如ap-southeast-1）

### 2.2 数据库迁移
- [ ] **迁移文件**：已执行所有迁移文件
  - `20250327000000_init.sql`（基础表）
  - `20250328000001_add_sms_hook.sql`（短信钩子）
  - `20250329000002_add_content_tables.sql`（内容表）
- [ ] **表验证**：确认以下表已创建：
  - `profiles`（用户资料）
  - `reports`（研报）
  - `education_topics`（投教内容）
  - `calendar_events`（日历事件）
  - `ipos`（新股）
  
  - `banners`（横幅）
  - `support_tickets`（工单）
- [ ] **索引验证**：确认所有索引已创建

### 2.3 RLS策略验证
- [ ] **策略状态**：所有内容表已启用RLS
- [ ] **策略验证**：测试以下策略：
  - 匿名用户可读取内容表
  - 普通用户无法写入内容表
  - 管理员用户可读写内容表

### 2.4 初始数据
- [ ] **管理员账号**：至少创建一个role='admin'的用户
- [ ] **示例数据**：确认迁移中的示例数据已插入
- [ ] **数据验证**：通过Supabase控制台验证数据完整性

## 3. 前端部署

### 3.1 环境变量
- [ ] **.env.production**：已创建并配置以下变量：
  ```env
  VITE_SUPABASE_URL=https://your-project.supabase.co
  VITE_SUPABASE_ANON_KEY=your-anon-key
  VITE_IS_DEMO_MODE=false
  VITE_API_BASE_URL=https://api.your-domain.com
  ```
- [ ] **变量验证**：确认变量值正确且无敏感信息泄露

### 3.2 构建与部署
- [ ] **依赖安装**：`npm install` 已执行
- [ ] **构建应用**：`npm run build` 已执行且无错误
- [ ] **构建产物**：`dist/` 目录已生成且包含所有文件
- [ ] **文件权限**：Web服务器对构建文件有读取权限

### 3.3 Web服务器配置
- [ ] **Nginx/Apache**：已安装并配置
- [ ] **虚拟主机**：已配置指向构建目录
- [ ] **反向代理**：已配置API代理（如需要）
- [ ] **缓存策略**：已配置静态资源缓存
- [ ] **Gzip压缩**：已启用

## 4. 内容管理模块专项检查

### 4.1 管理后台访问
- [ ] **管理员登录**：使用管理员账号可成功登录
- [ ] **路由访问**：可访问所有管理页面：
  - `/admin/dashboard`（仪表板）
  - `/admin/reports`（研报管理）
  - `/admin/education`（投教内容管理）
  - `/admin/calendar`（日历事件管理）
  - `/admin/ipos`（新股管理）
  
  - `/admin/banners`（横幅管理）
- [ ] **权限验证**：普通用户无法访问管理页面

### 4.2 数据加载测试
- [ ] **列表加载**：所有管理页面正常显示数据列表
- [ ] **空状态**：清空表数据后显示"暂无数据"
- [ ] **加载状态**：数据加载时显示加载指示器
- [ ] **错误处理**：断开网络时显示适当错误信息

### 4.3 CRUD操作测试
- [ ] **创建功能**：每个页面可成功创建新记录
- [ ] **必填验证**：不填必填字段时有提示
- [ ] **编辑功能**：可成功编辑现有记录
- [ ] **删除功能**：可成功删除记录（有确认提示）
- [ ] **取消操作**：取消创建/编辑时无数据变化

### 4.4 降级机制测试
- [ ] **演示模式**：设置`VITE_IS_DEMO_MODE=true`时使用模拟数据
- [ ] **连接失败**：断开Supabase连接时自动降级
- [ ] **控制台警告**：降级时控制台显示警告信息
- [ ] **用户体验**：降级时用户界面无明显中断

## 5. 集成测试

### 5.1 前端展示验证
- [ ] **用户界面**：普通用户可访问相关内容页面：
  - 研报中心：数据与后台一致
  - 投教中心：内容正常显示
  - 日历视图：事件正常显示
  - 新股列表：数据正常显示
  - 衍生品列表：数据正常显示
  - 首页横幅：轮播正常
- [ ] **数据同步**：后台修改后前端及时更新

### 5.2 仪表板联动
- [ ] **统计显示**：AdminDashboard显示系统统计（待实现内容统计）
- [ ] **实时更新**：统计数据定期更新
- [ ] **图表显示**：交易热度图表正常显示

## 6. 性能与安全

### 6.1 性能测试
- [ ] **页面加载**：管理页面加载时间 < 3秒
- [ ] **数据库查询**：复杂查询响应时间 < 1秒
- [ ] **内存使用**：长时间运行无内存泄漏
- [ ] **并发测试**：支持至少50个并发用户

### 6.2 安全检查
- [ ] **XSS防护**：用户输入已转义
- [ ] **CSRF防护**：已实施CSRF保护
- [ ] **SQL注入**：使用参数化查询
- [ ] **权限验证**：前端和后端双重验证
- [ ] **敏感数据**：API密钥等敏感信息未暴露

### 6.3 监控与日志
- [ ] **错误监控**：已配置错误跟踪（如Sentry）
- [ ] **访问日志**：Web服务器访问日志已启用
- [ ] **性能监控**：已配置性能监控工具
- [ ] **数据库监控**：Supabase监控已配置

## 7. 备份与恢复

### 7.1 备份策略
- [ ] **数据库备份**：已配置自动每日备份
- [ ] **文件备份**：已配置构建文件备份
- [ ] **备份验证**：定期测试备份文件可恢复
- [ ] **备份存储**：备份存储在安全位置

### 7.2 恢复测试
- [ ] **恢复流程**：已文档化恢复步骤
- [ ] **恢复测试**：定期进行恢复演练
- [ ] **恢复时间**：目标恢复时间 < 4小时

## 8. 文档与培训

### 8.1 文档准备
- [ ] **管理员手册**：`docs/admin-manual.md` 已提供
- [ ] **开发指南**：`docs/development-guide.md` 已提供
- [ ] **部署清单**：本检查清单已提供
- [ ] **API文档**：如有API，已提供文档

### 8.2 培训材料
- [ ] **管理员培训**：已准备培训材料
- [ ] **操作视频**：已录制关键操作视频
- [ ] **常见问题**：已整理常见问题解答
- [ ] **联系方式**：已提供技术支持联系方式

## 9. 上线前最终检查

### 9.1 功能验证
- [ ] **全流程测试**：完成端到端测试
- [ ] **边界测试**：测试边界条件和异常情况
- [ ] **兼容性测试**：测试主流浏览器兼容性
- [ ] **移动端测试**：测试移动设备适配

### 9.2 上线准备
- [ ] **上线计划**：已制定详细上线计划
- [ ] **回滚方案**：已准备回滚方案
- [ ] **通知用户**：已通知相关用户
- [ ] **值班安排**：已安排上线期间值班人员

### 9.3 上线后监控
- [ ] **实时监控**：上线后实时监控系统状态
- [ ] **用户反馈**：收集并处理用户反馈
- [ ] **性能基准**：记录上线后性能基准
- [ ] **问题跟踪**：跟踪并解决上线问题

## 10. 紧急响应

### 10.1 紧急联系人
- [ ] **技术负责人**：姓名、电话、邮箱
- [ ] **数据库管理员**：姓名、电话、邮箱
- [ ] **网络管理员**：姓名、电话、邮箱
- [ ] **业务负责人**：姓名、电话、邮箱

### 10.2 紧急流程
- [ ] **问题上报**：明确问题上报流程
- [ ] **应急响应**：制定应急响应流程
- [ ] **沟通渠道**：建立紧急沟通渠道
- [ ] **事后复盘**：问题解决后进行复盘

---

## 检查结果

### 检查人信息
- **姓名**：____________________
- **职位**：____________________
- **检查日期**：____________________

### 检查结果
- **通过项数**：______ / 总项数
- **未通过项**：____________________
- **备注**：____________________

### 签字确认
- **检查人签字**：____________________
- **负责人签字**：____________________
- **日期**：____________________

---

**文档版本**：1.0  
**更新日期**：2025-03-27  
**适用环境**：生产环境